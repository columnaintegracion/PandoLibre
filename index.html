<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PERSONALIZA TU FOTO Y SE PARTE DE LIBRE</title>
  <!-- Fuente similar a Franklin Gothic Heavy -->
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
  <style>
    :root{ --accent:#e50914; }
    *{ box-sizing:border-box }
    body{
      font-family:Arial, sans-serif;
      margin:0;
      padding:16px;
      background:#fafafa;
      color:#222;
      text-align:center;
    }
    .wrap{
      width:100%;
      max-width:560px;
      margin:0 auto;
    }

    /* Encabezado */
    h2{
      font-family:'Anton', Arial, sans-serif;
      font-size:2rem; /* Más grande */
      margin:0 0 12px;
      color:#fe0000;  /* solicitado */
      letter-spacing:.5px;
      text-transform:uppercase;
      text-shadow:0 1px 0 #fff, 0 2px 6px rgba(0,0,0,.08);
    }

    .controls{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    .controls.single{ grid-template-columns:1fr }
    input[type="file"], input[type="text"]{
      padding:12px; font-size:16px; border:1px solid #ddd; border-radius:8px; background:#fff;
    }
    .buttons{ display:flex; gap:10px; margin-top:12px; }
    .button{
      padding:12px 16px; border:0; border-radius:10px;
      background:var(--accent); color:#fff; cursor:pointer; text-decoration:none; font-weight:600;
      flex:1; text-align:center;
    }
    canvas{
      display:block; width:100%; height:auto;
      background:#f5f5f5; border-radius:12px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      margin-top:10px;
    }
    small{
      display:block;
      color:#223c77;
      margin-top:8px;
      line-height:1.3;
    }

    @media (max-width:520px){
      .controls{ grid-template-columns:1fr }
      .buttons{ flex-direction:column }
      h2{ font-size:1.6rem }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>!.... YO SOY LIBRE ....!</h2>

    <div class="controls">
      <input type="file" id="upload" accept="image/*" />
      <input type="text" id="userText" placeholder="TEXTO PERSONALIZADO" maxlength="40" />
    </div>

    <canvas id="canvas" width="980" height="980" aria-label="Lienzo de previsualización"></canvas>

    <div class="buttons">
      <a id="downloadLink" class="button" download="mi_estado.png">Descargar Imagen</a>
    </div>

    <small>Presionar en Descargar Imagen y se Parte de Pando Libre</small>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const upload = document.getElementById('upload');
    const userText = document.getElementById('userText');

    const marco = new Image();
    marco.crossOrigin = "anonymous";
    marco.src = 'https://i.imgur.com/4erirN6.png';

    let fotoUsuario = null;

    upload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        fotoUsuario = new Image();
        fotoUsuario.onload = dibujar;
        fotoUsuario.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    let typingTimer;
    userText.addEventListener('input', () => {
      clearTimeout(typingTimer);
      typingTimer = setTimeout(dibujar, 20);
    });

    marco.onload = dibujar;

    function dibujar() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#fff";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (fotoUsuario) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2 - 10, 0, Math.PI * 2);
        ctx.closePath();
        ctx.clip();
        ctx.drawImage(fotoUsuario, 0, 0, canvas.width, canvas.height);
        ctx.restore();
      }

      ctx.drawImage(marco, 0, 0, canvas.width, canvas.height);

      const txt = userText.value.trim();
      if (txt !== "") {
        ctx.font = "bold 50px 'Anton', 'Franklin Gothic Heavy', sans-serif";
        ctx.textAlign = "center";
        ctx.fillStyle = "#223c77";
        ctx.lineWidth = 5;
        ctx.strokeStyle = "white";

        const x = canvas.width / 2;
        const y = canvas.height - 260;

        ctx.strokeText(txt.toUpperCase(), x, y);
        ctx.fillText(txt.toUpperCase(), x, y);
      }
    }

    document.getElementById('downloadLink').addEventListener('click', function () {
      const dataURL = canvas.toDataURL('image/png');
      this.href = dataURL;
    });

    window.addEventListener('orientationchange', () => setTimeout(dibujar, 50));
  </script>
</body>
</html>
